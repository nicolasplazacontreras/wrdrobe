
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WRDROBE</title>
    <!-- Incluye el CDN de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Instala la tipografía Outfit desde Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Define la nueva fuente para el cuerpo del documento */
        body {
            font-family: 'Outfit', sans-serif;
        }
        /* Oculta el input de tipo archivo para usar un estilo personalizado */
        .file-input {
            display: none;
        }
        .outfit-thumbnail {
            aspect-ratio: 4/5;
        }
        .item-thumbnail {
            aspect-ratio: 1;
        }
        
        /* Estilos para el scrollbar simplificado */
        .simple-scroll::-webkit-scrollbar {
            width: 8px;
        }

        .simple-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .simple-scroll::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .simple-scroll::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body class="bg-stone-100 min-h-screen flex flex-col items-center justify-between p-4 pb-20">

    <!-- Contenedor principal de la aplicación -->
    <div class="max-w-sm w-full mx-auto flex-grow flex flex-col items-center rounded-lg shadow-lg bg-white">

        <!-- Vista de la página principal (Home) -->
        <div id="home-view" class="w-full h-full flex flex-col items-center justify-center p-2 md:p-4">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Bienvenido a tu closet</h1>
            <p class="text-center text-gray-600">
                Organiza tus items y outfits, y encuentra la inspiración para tu próximo look.
            </p>
        </div>

        <!-- Vista de la página de Outfits, inicialmente oculta -->
        <div id="outfits-view" class="w-full h-full p-4 md:p-8 flex-col items-center hidden">
            <div class="flex items-center justify-center w-full mb-6">
                <!-- Ícono de camiseta -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-700 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 12h2a1 1 0 001-1V5a1 1 0 00-1-1H11a1 1 0 00-1 1v6a1 1 0 001 1z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v-2a2 2 0 012-2h12a2 2 0 012 2v2M4 16a2 2 0 002 2h12a2 2 0 002-2M4 16a2 2 0 01-2-2v-2a2 2 0 012-2h12a2 2 0 012 2v2a2 2 0 01-2 2" />
                </svg>
                <h2 class="text-2xl font-bold text-gray-800">
                    Mis Outfits
                </h2>
            </div>
            
            <!-- Contenedor para la cuadrícula de miniaturas -->
            <div id="outfits-grid" class="grid grid-cols-3 gap-1 w-full">
                <!-- Miniaturas de outfits se renderizan aquí -->
            </div>
        </div>

        <!-- Vista de un único outfit, ahora dentro del contenedor principal -->
        <div id="single-outfit-view" class="w-full h-full p-4 md:p-8 flex-col items-center hidden relative">
            <!-- Botón para regresar a la vista de outfits -->
            <button id="back-to-outfits-button" class="absolute top-4 left-4 p-2 rounded-full bg-gray-200 text-gray-600 hover:bg-gray-300 transition-colors duration-200 z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>

            <!-- Botón de opciones (tres puntos) en la esquina superior derecha -->
            <div class="absolute top-4 right-4 z-10">
                <button id="outfit-options-button" class="p-2 rounded-full bg-gray-200 text-gray-600 hover:bg-gray-300 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                    </svg>
                </button>
                <div id="outfit-options-menu" class="absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg hidden">
                    <button id="edit-outfit-button" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200">Modificar</button>
                    <button id="delete-outfit-button" class="block w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-100 transition-colors duration-200">Eliminar</button>
                </div>
            </div>

            <!-- Placeholder grande para el outfit seleccionado -->
            <div class="w-full flex-grow single-outfit-placeholder bg-gray-200 overflow-hidden flex items-center justify-center text-gray-400 font-bold text-xl mb-6">
                Outfit seleccionado
            </div>

            <!-- Título para los ítems -->
            <h3 class="text-lg font-bold text-gray-800 mb-4">
                Ítems usados en este outfit
            </h3>

            <!-- Contenedor para los ítems del outfit -->
            <div id="outfit-items-grid" class="grid grid-cols-2 gap-1 w-full">
                <!-- Items del outfit se renderizan aquí -->
            </div>
        </div>

        <!-- Vista de la página de Items, inicialmente oculta -->
        <div id="items-view" class="w-full h-full p-4 md:p-8 flex-col items-center hidden">
            <div class="flex items-center justify-center w-full mb-6">
                <!-- Ícono de etiqueta (tag) -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-700 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h10a2 2 0 012 2v10a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2z" />
                </svg>
                <h2 class="text-2xl font-bold text-gray-800">
                    Mis Items
                </h2>
            </div>
            
            <!-- Contenedor de categorías con una cuadrícula fija para 2 líneas -->
            <div id="categories-container" class="w-full flex flex-wrap justify-center gap-2 py-2 text-center">
                <!-- Los botones de categorías se renderizan aquí -->
            </div>
            
            <!-- Nuevo contenedor para las etiquetas de los items -->
            <div id="tags-container" class="w-full flex flex-wrap justify-center items-center py-2 gap-2">
                <!-- Los botones de etiquetas se renderizan aquí -->
            </div>

            <!-- Cuadrícula para los placeholders de items (2 por fila, 12 en total) -->
            <div id="items-grid" class="grid grid-cols-2 gap-1 w-full mt-4">
                <!-- Los ítems se renderizan aquí -->
            </div>
        </div>

        <!-- Nueva vista para mostrar un solo ítem -->
        <div id="single-item-view" class="w-full h-full p-4 md:p-8 flex-col items-center hidden relative">
            <!-- Botón para regresar a la vista de items -->
            <button id="back-to-items-button" class="absolute top-4 left-4 p-2 rounded-full bg-gray-200 text-gray-600 hover:bg-gray-300 transition-colors duration-200 z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            
            <!-- Botón de opciones (tres puntos) en la esquina superior derecha -->
            <div class="absolute top-4 right-4 z-10">
                <button id="item-options-button" class="p-2 rounded-full bg-gray-200 text-gray-600 hover:bg-gray-300 transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                    </svg>
                </button>
                <div id="item-options-menu" class="absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg hidden">
                    <button id="edit-item-button" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200">Modificar</button>
                    <button id="delete-item-button" class="block w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-100 transition-colors duration-200">Eliminar</button>
                </div>
            </div>

            <!-- Placeholder grande para el ítem seleccionado -->
            <div id="item-image" class="w-full flex-grow item-image-placeholder bg-gray-200 overflow-hidden flex items-center justify-center text-gray-400 font-bold text-xl mb-6">
                <!-- La imagen del ítem se renderiza aquí -->
            </div>
            
            <!-- Detalles del ítem (Nombre, Categoría, Etiquetas) -->
            <div class="w-full text-center mb-6">
                <h3 id="item-name" class="text-xl font-bold text-gray-800 mb-1"></h3>
                <div id="item-tags" class="flex flex-wrap justify-center gap-2">
                    <!-- Las etiquetas del ítem se renderizan aquí -->
                </div>
                <p id="item-category" class="text-sm text-gray-500 mt-2"></p>
            </div>

            <!-- Título para los outfits -->
            <h3 class="text-lg font-bold text-gray-800 mb-4">
                Outfits con este ítem
            </h3>

            <!-- Contenedor para los outfits con el ítem seleccionado -->
            <div id="item-outfits-grid" class="grid grid-cols-2 gap-1 w-full">
                <!-- Los outfits con el ítem se renderizan aquí -->
            </div>
        </div>

        <!-- Nueva vista de búsqueda -->
        <div id="search-view" class="w-full h-full p-4 md:p-8 flex-col items-center hidden">
            <!-- Barra de búsqueda -->
            <div class="w-full relative mb-4">
                <input id="search-input" type="text" placeholder="Buscar items, outfits, categorías..." class="w-full pl-10 pr-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:border-violet-500 transition-colors duration-200">
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-400">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>
            
            <!-- Etiquetas de búsqueda sugeridas -->
            <div id="suggested-tags" class="w-full flex flex-wrap justify-center items-center py-2 gap-2 mb-4">
                <!-- Las etiquetas sugeridas se renderizan aquí -->
            </div>
            
            <!-- Contenedor de resultados de búsqueda (inicialmente vacío) -->
            <div id="search-results-container" class="grid grid-cols-2 gap-1 w-full flex-grow">
            </div>
        </div>

    </div>

    <!-- Barra de Navegación Inferior -->
    <nav class="fixed bottom-0 w-full max-w-sm h-16 bg-white border-t border-gray-200 flex justify-around items-center px-4 md:px-8 shadow-2xl">
        <!-- Botón de Inicio -->
        <button id="home-button" class="flex flex-col items-center text-violet-500 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-10l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
        </button>

        <!-- Botón de Buscar -->
        <button id="search-button" class="flex flex-col items-center text-gray-400 hover:text-violet-500 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        </button>

        <!-- Botón de Subir Fotos (el del medio) -->
        <button id="upload-button" class="flex items-center justify-center h-12 w-12 rounded-full bg-violet-500 text-white shadow-xl cursor-pointer hover:bg-violet-600 transition-colors duration-200 -mt-8">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
        </button>
        
        <!-- Botón de Items (el 4to) -->
        <button id="items-button" class="flex flex-col items-center text-gray-400 hover:text-violet-500 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h10a2 2 0 012 2v10a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2z" />
            </svg>
        </button>

        <!-- Botón de Outfits (Colgador de ropa) -->
        <button id="outfits-button" class="flex flex-col items-center text-gray-400 hover:text-violet-500 transition-colors duration-200">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 10a4 4 0 014-4h8a4 4 0 014 4m-4 0v4m-4-4v4m-4-4v4m-4 0h14a2 2 0 012 2v2a2 2 0 01-2 2H4a2 2 0 01-2-2v-2a2 2 0 012-2z"></path>
            </svg>
        </button>
    </nav>
    
    <!-- Modal de Carga con Pestañas (Reemplazo) -->
    <div id="upload-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-20">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-xs">
            <!-- Pestañas del modal -->
            <div class="flex border-b border-gray-200 mb-4">
                <button id="upload-item-tab" class="flex-1 text-center py-2 text-sm font-semibold border-b-2 border-violet-500 text-violet-500 transition-colors">
                    Subir Ítem
                </button>
                <button id="upload-outfit-tab" class="flex-1 text-center py-2 text-sm font-semibold text-gray-400 border-b-2 border-transparent transition-colors">
                    Subir Outfit
                </button>
            </div>
            
            <!-- Contenido de la pestaña de Subir Ítem -->
            <div id="upload-item-content">
                <h3 class="text-xl font-bold text-center mb-4 text-gray-800">Cargar un nuevo Ítem</h3>
                <div class="flex flex-col gap-4">
                    <label for="new-item-image-input" class="text-gray-700 font-medium">Imagen del Ítem:</label>
                    <div class="relative w-full aspect-[2.35/1] overflow-hidden rounded-lg shadow-inner">
                        <img id="new-item-image-preview" class="object-cover w-full h-full bg-gray-200" src="https://placehold.co/400x400/E5E7EB/4B5563?text=Sin+imagen">
                        <button id="new-item-camera-button" class="absolute bottom-2 right-2 p-2 rounded-full bg-white shadow-md text-gray-700 hover:bg-gray-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 5-4V5h1v10zm-9-5l2 2 4-4 2 4v2H4v-2l2-2 3 3z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <input id="new-item-image-input" type="file" class="file-input" accept="image/*" capture="camera">
                    </div>

                    <label for="new-item-name" class="text-gray-700 font-medium">Nombre:</label>
                    <input id="new-item-name" type="text" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-violet-500">
                    
                    <label for="new-category-select" class="text-gray-700 font-medium">Categoría:</label>
                    <select id="new-category-select" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-violet-500">
                        <!-- Las opciones se llenan dinámicamente -->
                    </select>

                    <label for="new-item-tag-input" class="text-gray-700 font-medium">Etiquetas:</label>
                    <div id="new-item-tags-container" class="flex flex-wrap gap-2 p-2 rounded-lg bg-gray-100">
                        <!-- Las etiquetas se renderizan aquí -->
                    </div>
                    <input id="new-item-tag-input" type="text" placeholder="Añadir nueva etiqueta..." class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-violet-500">
                    <div id="new-item-suggested-tags" class="flex flex-wrap gap-2 mt-2 max-h-24 overflow-y-auto simple-scroll">
                        <!-- Las etiquetas sugeridas se renderizan aquí -->
                    </div>
                </div>
                <div class="flex gap-4 mt-6">
                    <button id="save-new-item-button" class="flex-1 px-4 py-3 bg-violet-500 text-white font-semibold rounded-lg hover:bg-violet-600 transition-colors">
                        Subir Ítem
                    </button>
                    <button id="cancel-new-item-button" class="flex-1 px-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">
                        Cancelar
                    </button>
                </div>
            </div>

            <!-- Contenido de la pestaña de Subir Outfit -->
            <div id="upload-outfit-content" class="hidden">
                <h3 class="text-xl font-bold text-center mb-4 text-gray-800">Cargar un nuevo Outfit</h3>
                <div class="flex flex-col gap-4">
                    <label for="new-outfit-name" class="text-gray-700 font-medium">Nombre:</label>
                    <input id="new-outfit-name" type="text" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-violet-500">

                    <label class="text-gray-700 font-medium">Imagen del Outfit:</label>
                    <div class="relative w-full aspect-[2.35/1] overflow-hidden rounded-lg shadow-inner">
                        <img id="new-outfit-image-preview" class="object-cover w-full h-full bg-gray-200" src="https://placehold.co/400x500/E5E7EB/4B5563?text=Sin+imagen">
                        <button id="new-outfit-camera-button" class="absolute bottom-2 right-2 p-2 rounded-full bg-white shadow-md text-gray-700 hover:bg-gray-100 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 5-4V5h1v10zm-9-5l2 2 4-4 2 4v2H4v-2l2-2 3 3z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <input id="new-outfit-image-input" type="file" class="file-input" accept="image/*" capture="camera">
                    </div>

                    <label class="text-gray-700 font-medium">Items:</label>
                    <div id="new-outfit-items-container" class="grid grid-cols-3 gap-1 w-full bg-gray-100 p-2 rounded-lg overflow-y-auto max-h-48 simple-scroll">
                        <!-- Los ítems del outfit se renderizan aquí -->
                    </div>

                    <label for="new-outfit-tag-input" class="text-gray-700 font-medium">Etiquetas:</label>
                    <div id="new-outfit-tags-container" class="flex flex-wrap gap-2 p-2 rounded-lg bg-gray-100">
                        <!-- Las etiquetas del outfit se renderizan aquí -->
                    </div>
                    <input id="new-outfit-tag-input" type="text" placeholder="Añadir nueva etiqueta..." class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-violet-500">
                    <div id="new-outfit-suggested-tags" class="flex flex-wrap gap-2 mt-2 max-h-24 overflow-y-auto simple-scroll">
                        <!-- Las etiquetas sugeridas se renderizan aquí -->
                    </div>
                </div>
                <div class="flex gap-4 mt-6">
                    <button id="save-new-outfit-button" class="flex-1 px-4 py-3 bg-violet-500 text-white font-semibold rounded-lg hover:bg-violet-600 transition-colors">
                        Subir Outfit
                    </button>
                    <button id="cancel-new-outfit-button" class="flex-1 px-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de edición de ítem -->
    <div id="edit-item-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-30">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-xs">
            <h3 class="text-xl font-bold text-center mb-4 text-gray-800">Modificar Item</h3>
            <div class="flex flex-col gap-4">
                <label for="edit-item-name" class="text-gray-700 font-medium">Nombre:</label>
                <input id="edit-item-name" type="text" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-violet-500">
                
                <!-- Contenedor para la vista previa de la imagen con la relación de aspecto -->
                <div class="relative w-full aspect-[2.35/1] overflow-hidden rounded-lg shadow-inner">
                    <img id="edit-item-image-preview" class="object-cover w-full h-full bg-gray-200" src="https://placehold.co/400x400/E5E7EB/4B5563?text=Sin+imagen">
                    <!-- Botón de lápiz en la esquina inferior derecha -->
                    <button id="edit-image-button" class="absolute bottom-2 right-2 p-2 rounded-full bg-white shadow-md text-gray-700 hover:bg-gray-100 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                        </svg>
                    </button>
                    <!-- Input de archivo, oculto para usar con el botón de lápiz -->
                    <input id="edit-item-image-input" type="file" class="file-input" accept="image/*">
                    <!-- Menú flotante para opciones de foto -->
                    <div id="edit-image-menu" class="absolute bottom-10 right-2 w-48 bg-white rounded-lg shadow-lg hidden">
                        <button id="select-image-option" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">Seleccionar nueva imagen</button>
                        <button id="take-photo-option" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">Tomar foto con la cámara</button>
                    </div>
                </div>

                <label for="edit-category-select" class="text-gray-700 font-medium">Categoría:</label>
                <select id="edit-category-select" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-violet-500">
                    <!-- Las opciones se llenan dinámicamente -->
                </select>
            </div>
            <div class="mt-4">
                <label for="tag-input" class="text-gray-700 font-medium">Etiquetas:</label>
                <!-- Contenedor para las etiquetas del ítem que se están editando -->
                <div id="editing-tags-container" class="flex flex-wrap gap-2 mt-2 p-2 rounded-lg bg-gray-100">
                    <!-- Las etiquetas de edición se renderizan aquí -->
                </div>
                <!-- Input para agregar nuevas etiquetas -->
                <input id="tag-input" type="text" placeholder="Añadir nueva etiqueta..." class="w-full mt-2 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-violet-500">
                <div id="suggested-editing-tags" class="flex flex-wrap gap-2 mt-2 max-h-24 overflow-y-auto simple-scroll">
                    <!-- Las etiquetas sugeridas se renderizan aquí -->
                </div>
                <div class="w-full text-center mt-2">
                    <button id="edit-delete-tags-button" class="text-sm text-gray-600 font-normal flex items-center gap-1 mx-auto hover:text-gray-800 transition-colors">
                        Modificar/Eliminar etiquetas
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="flex gap-4 mt-6">
                <button id="save-item-changes-button" class="flex-1 px-4 py-3 bg-violet-500 text-white font-semibold rounded-lg hover:bg-violet-600 transition-colors">
                    Guardar
                </button>
                <button id="cancel-edit-button" class="flex-1 px-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Nuevo Modal de Edición de Outfits -->
    <div id="edit-outfit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-30">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-xs">
            <h3 class="text-xl font-bold text-center mb-4 text-gray-800">Modificar Outfit</h3>
            <div class="flex flex-col gap-4">
                <label for="edit-outfit-name" class="text-gray-700 font-medium">Nombre:</label>
                <input id="edit-outfit-name" type="text" class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-violet-500">
                
                <!-- Contenedor para la vista previa de la imagen del outfit -->
                <div class="relative w-full aspect-[2.35/1] overflow-hidden rounded-lg shadow-inner">
                    <img id="edit-outfit-image-preview" class="object-cover w-full h-full bg-gray-200" src="https://placehold.co/400x500/E5E7EB/4B5563?text=Sin+imagen">
                    <!-- Botón de lápiz en la esquina inferior derecha -->
                    <button id="edit-outfit-image-button" class="absolute bottom-2 right-2 p-2 rounded-full bg-white shadow-md text-gray-700 hover:bg-gray-100 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                        </svg>
                    </button>
                    <!-- Input de archivo, oculto para usar con el botón de lápiz -->
                    <input id="edit-outfit-image-input" type="file" class="file-input" accept="image/*">
                </div>

                <label class="text-gray-700 font-medium">Items:</label>
                <!-- Contenedor para los ítems seleccionados para el outfit -->
                <div id="editing-outfit-items-container" class="grid grid-cols-3 gap-1 w-full bg-gray-100 p-2 rounded-lg overflow-y-auto max-h-48 simple-scroll">
                    <!-- Los ítems del outfit se renderizan aquí -->
                </div>
            </div>
            
            <div class="mt-4">
                <label for="edit-outfit-tag-input" class="text-gray-700 font-medium">Etiquetas:</label>
                <!-- Contenedor para las etiquetas del outfit que se están editando -->
                <div id="editing-outfit-tags-container" class="flex flex-wrap gap-2 mt-2 p-2 rounded-lg bg-gray-100">
                    <!-- Las etiquetas de edición se renderizan aquí -->
                </div>
                <!-- Input para agregar nuevas etiquetas -->
                <input id="edit-outfit-tag-input" type="text" placeholder="Añadir nueva etiqueta..." class="w-full mt-2 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:border-violet-500">
                <div id="suggested-editing-outfit-tags" class="flex flex-wrap gap-2 mt-2 max-h-24 overflow-y-auto simple-scroll">
                    <!-- Las etiquetas sugeridas se renderizan aquí -->
                </div>
            </div>

            <div class="flex gap-4 mt-6">
                <button id="save-outfit-changes-button" class="flex-1 px-4 py-3 bg-violet-500 text-white font-semibold rounded-lg hover:bg-violet-600 transition-colors">
                    Guardar
                </button>
                <button id="cancel-outfit-edit-button" class="flex-1 px-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal para eliminar etiquetas globalmente -->
    <div id="global-tag-edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-40">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-xs">
            <h3 class="text-xl font-bold text-center mb-4 text-gray-800">Eliminar Etiquetas</h3>
            <p class="text-sm text-gray-600 text-center mb-4">
                Toca una etiqueta para eliminarla de forma permanente de todos los ítems y outfits.
            </p>
            <div id="all-tags-container" class="flex flex-wrap gap-2 mt-2 max-h-48 overflow-y-auto simple-scroll">
                <!-- Todas las etiquetas se renderizan aquí -->
            </div>
            <button id="close-tag-modal-button" class="mt-6 w-full px-4 py-3 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">
                Listo
            </button>
        </div>
    </div>
    
    <!-- Mensaje de guardado -->
    <div id="save-message" class="fixed inset-0 flex items-center justify-center hidden z-50 transition-opacity duration-300">
        <div class="flex flex-col items-center justify-center w-32 h-32 bg-black bg-opacity-70 rounded-lg text-white text-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
            <span class="mt-2 text-sm font-medium">Guardado</span>
        </div>
    </div>

    <script>
        // Data de prueba, simulando una base de datos
        let items = [
            {
                id: 'item-1',
                name: 'Camiseta gris',
                category: 'Tops',
                image: 'https://cl.scalperscompany.com/cdn/shop/files/32094-DARKGREY-S-1.jpg?v=1740574182',
                tags: ['gris', 'básico', 'algodón', 'verano']
            },
            {
                id: 'item-2',
                name: 'Pantalón cargo',
                category: 'Bottoms',
                image: 'https://asrv.com/cdn/shop/files/0824_IvoryCream_1200x.jpg?v=1708647105',
                tags: ['beige', 'cargo', 'casual', 'otoño']
            },
            {
                id: 'item-3',
                name: 'Vestido floral',
                category: 'Vestidos',
                image: 'https://placehold.co/400x500/FFF/000?text=Vestido+Floral',
                tags: ['flores', 'verano', 'largo']
            },
            {
                id: 'item-4',
                name: 'Sombrero de paja',
                category: 'Sombreros',
                image: 'https://placehold.co/400x500/E5E7EB/4B5563?text=Sombrero+de+Paja',
                tags: ['playa', 'verano', 'accesorio']
            },
            {
                id: 'item-5',
                name: 'Collar de perlas',
                category: 'Accesorios',
                image: 'https://placehold.co/400x500/FFF/000?text=Collar+de+Perlas',
                tags: ['elegante', 'joyas', 'fiesta']
            },
            {
                id: 'item-6',
                name: 'Bolso tote',
                category: 'Bolsos',
                image: 'https://placehold.co/400x500/E5E7EB/4B5563?text=Bolso+Tote',
                tags: ['cuero', 'diario', 'grande']
            },
            {
                id: 'item-7',
                name: 'Chaqueta de cuero',
                category: 'Tops',
                image: 'https://gongoshop.com.ar/wp-content/uploads/2024/06/5007-1-rd1.jpg',
                tags: ['negro', 'rocker', 'cuero', 'invierno']
            },
            {
                id: 'item-8',
                name: 'Zapatillas negras',
                category: 'Zapatos',
                image: 'https://www.mrporter.com/variants/images/1647597292535885/in/w2000_q60.jpg',
                tags: ['negro', 'deportivo', 'zapatillas', 'urbano']
            },
            {
                id: 'item-9',
                name: 'Pantalón vaquero',
                category: 'Bottoms',
                image: 'https://placehold.co/400x500/FFF/000?text=Pantalón+Vaquero',
                tags: ['azul', 'clásico', 'jeans']
            }
        ];

        let outfits = [
            {
                id: 'outfit-1',
                name: 'Outfit Casual de Verano',
                image: 'https://i.pinimg.com/1200x/90/67/49/906749685135f1fa9d772d14fb22a3a6.jpg',
                items: ['item-1', 'item-2', 'item-4'],
                tags: ['casual', 'verano', 'urbano']
            },
            {
                id: 'outfit-2',
                name: 'Outfit de Noche Elegante',
                image: 'https://placehold.co/400x500/E5E7EB/4B5563?text=Outfit+2',
                items: ['item-3', 'item-5'],
                tags: ['elegante', 'noche', 'fiesta']
            },
             {
                id: 'outfit-3',
                name: 'Outfit Diario',
                image: 'https://placehold.co/400x500/E5E7EB/4B5563?text=Outfit+3',
                items: ['item-1', 'item-6'],
                tags: ['casual', 'diario']
            },
        ];

        // Obtener referencias a las diferentes vistas de la aplicación
        const homeView = document.getElementById('home-view');
        const outfitsView = document.getElementById('outfits-view');
        const itemsView = document.getElementById('items-view');
        const singleOutfitView = document.getElementById('single-outfit-view');
        const singleItemView = document.getElementById('single-item-view');
        const searchView = document.getElementById('search-view');

        // Obtener referencias a los botones de navegación y a los botones de retroceso
        const homeButton = document.getElementById('home-button');
        const outfitsButton = document.getElementById('outfits-button');
        const itemsButton = document.getElementById('items-button');
        const searchButton = document.getElementById('search-button');
        const backToOutfitsButton = document.getElementById('back-to-outfits-button');
        const backToItemsButton = document.getElementById('back-to-items-button');
        const uploadButton = document.getElementById('upload-button');

        // Obtener referencias a la nueva modal de subida y sus elementos
        const uploadModal = document.getElementById('upload-modal');
        const uploadItemTab = document.getElementById('upload-item-tab');
        const uploadOutfitTab = document.getElementById('upload-outfit-tab');
        const uploadItemContent = document.getElementById('upload-item-content');
        const uploadOutfitContent = document.getElementById('upload-outfit-content');
        
        // Elementos del formulario de subida de Ítem
        const newItemImageInput = document.getElementById('new-item-image-input');
        const newItemImagePreview = document.getElementById('new-item-image-preview');
        const newItemCameraBtn = document.getElementById('new-item-camera-button');
        const newItemNameInput = document.getElementById('new-item-name');
        const newCategorySelect = document.getElementById('new-category-select');
        const newItemTagInput = document.getElementById('new-item-tag-input');
        const newItemTagsContainer = document.getElementById('new-item-tags-container');
        const newItemSuggestedTags = document.getElementById('new-item-suggested-tags');
        const saveNewItemButton = document.getElementById('save-new-item-button');
        const cancelNewItemButton = document.getElementById('cancel-new-item-button');
        
        // Elementos del formulario de subida de Outfit
        const newOutfitNameInput = document.getElementById('new-outfit-name');
        const newOutfitImageInput = document.getElementById('new-outfit-image-input');
        const newOutfitImagePreview = document.getElementById('new-outfit-image-preview');
        const newOutfitCameraBtn = document.getElementById('new-outfit-camera-button');
        const newOutfitItemsContainer = document.getElementById('new-outfit-items-container');
        const newOutfitTagInput = document.getElementById('new-outfit-tag-input');
        const newOutfitTagsContainer = document.getElementById('new-outfit-tags-container');
        const newOutfitSuggestedTags = document.getElementById('new-outfit-suggested-tags');
        const saveNewOutfitButton = document.getElementById('save-new-outfit-button');
        const cancelNewOutfitButton = document.getElementById('cancel-new-outfit-button');

        // Obtener referencias a la modal de edición y sus elementos
        const editItemModal = document.getElementById('edit-item-modal');
        const editItemNameInput = document.getElementById('edit-item-name');
        const editItemImageInput = document.getElementById('edit-item-image-input');
        const editItemImagePreview = document.getElementById('edit-item-image-preview');
        const editCategorySelect = document.getElementById('edit-category-select');
        const saveItemChangesButton = document.getElementById('save-item-changes-button');
        const cancelEditButton = document.getElementById('cancel-edit-button');
        const editingTagsContainer = document.getElementById('editing-tags-container');
        const tagInput = document.getElementById('tag-input');
        const suggestedEditingTags = document.getElementById('suggested-editing-tags');
        const editImageButton = document.getElementById('edit-image-button');
        const editImageMenu = document.getElementById('edit-image-menu');
        const selectImageOption = document.getElementById('select-image-option');
        const takePhotoOption = document.getElementById('take-photo-option');
        const editDeleteTagsButton = document.getElementById('edit-delete-tags-button');

        // Referencias a la nueva modal de edición de outfits y sus elementos
        const editOutfitModal = document.getElementById('edit-outfit-modal');
        const editOutfitNameInput = document.getElementById('edit-outfit-name');
        const editOutfitImageInput = document.getElementById('edit-outfit-image-input');
        const editOutfitImagePreview = document.getElementById('edit-outfit-image-preview');
        const editOutfitImageButton = document.getElementById('edit-outfit-image-button');
        const editingOutfitItemsContainer = document.getElementById('editing-outfit-items-container');
        const editingOutfitTagsContainer = document.getElementById('editing-outfit-tags-container');
        const editOutfitTagInput = document.getElementById('edit-outfit-tag-input');
        const suggestedEditingOutfitTags = document.getElementById('suggested-editing-outfit-tags');
        const saveOutfitChangesButton = document.getElementById('save-outfit-changes-button');
        const cancelEditOutfitButton = document.getElementById('cancel-outfit-edit-button');
        
        // Referencias a la nueva modal de eliminación de etiquetas
        const globalTagEditModal = document.getElementById('global-tag-edit-modal');
        const allTagsContainer = document.getElementById('all-tags-container');
        const closeTagModalButton = document.getElementById('close-tag-modal-button');
        
        // Referencia al mensaje de guardado
        const saveMessage = document.getElementById('save-message');

        // Obtener referencias a las cuadrículas y botones de acción
        const outfitsGrid = document.getElementById('outfits-grid');
        const itemsGrid = document.getElementById('items-grid');
        const outfitItemsGrid = document.getElementById('outfit-items-grid');
        const itemOutfitsGrid = document.getElementById('item-outfits-grid');

        // Referencias a los nuevos botones de opciones
        const itemOptionsButton = document.getElementById('item-options-button');
        const itemOptionsMenu = document.getElementById('item-options-menu');
        const editItemButton = document.getElementById('edit-item-button');
        const deleteItemButton = document.getElementById('delete-item-button');
        
        const outfitOptionsButton = document.getElementById('outfit-options-button');
        const outfitOptionsMenu = document.getElementById('outfit-options-menu');
        const editOutfitButton = document.getElementById('edit-outfit-button');
        const deleteOutfitButton = document.getElementById('delete-outfit-button');

        // Obtener referencias a los elementos de la vista de un solo ítem
        const itemImage = document.getElementById('item-image');
        const itemName = document.getElementById('item-name');
        const itemTags = document.getElementById('item-tags');
        const itemCategory = document.getElementById('item-category');

        // Obtener referencias a los nuevos elementos de búsqueda
        const searchInput = document.getElementById('search-input');
        const searchResultsContainer = document.getElementById('search-results-container');
        const categoriesContainer = document.getElementById('categories-container');
        const tagsContainer = document.getElementById('tags-container');
        const suggestedTagsContainer = document.getElementById('suggested-tags');


        // Array de botones de navegación para simplificar el manejo de clases
        const navButtons = [homeButton, searchButton, itemsButton, outfitsButton];
        
        // Variable para rastrear el ítem seleccionado para edición
        let currentItem = null;
        // Variable para rastrear el outfit seleccionado para edición
        let currentOutfit = null;
        
        // Variables para la creación de nuevos elementos
        let newItemTags = [];
        let newOutfit = {
            name: '',
            image: '',
            items: [],
            tags: []
        };

        // Variables para rastrear los filtros activos
        let activeCategory = null;
        let activeTag = null;
        
        // Función para generar un ID único
        const generateId = () => `id-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
        
        // Función para obtener categorías únicas
        const getCategories = () => [...new Set(items.map(item => item.category))];
        
        // Función para obtener todas las etiquetas únicas
        const getAllTags = () => {
            const allTags = items.flatMap(item => item.tags).concat(outfits.flatMap(outfit => outfit.tags));
            return [...new Set(allTags)].sort();
        };
        
        // Función para eliminar una etiqueta de forma permanente
        function deleteTag(tagToDelete) {
            // Eliminar la etiqueta de todos los ítems
            items.forEach(item => {
                item.tags = item.tags.filter(tag => tag !== tagToDelete);
            });
            // Eliminar la etiqueta de todos los outfits
            outfits.forEach(outfit => {
                outfit.tags = outfit.tags.filter(tag => tag !== tagToDelete);
            });
            // Vuelve a renderizar las vistas afectadas
            renderAllTagsForModal();
            renderEditingTags();
            renderSuggestedEditingTags();
            filterItems();
        }
        
        // Función para mostrar un mensaje de guardado
        function showSaveMessage() {
            saveMessage.classList.remove('hidden');
            saveMessage.classList.add('flex');
            setTimeout(() => {
                saveMessage.classList.remove('flex');
                saveMessage.classList.add('hidden');
            }, 2000); // El mensaje desaparece después de 2 segundos
        }

        // Función para actualizar los colores de los botones de navegación
        function updateNavButtonColors(activeButton) {
            navButtons.forEach(button => {
                button.classList.remove('text-violet-500');
                button.classList.add('text-gray-400', 'hover:text-violet-500');
            });
            activeButton.classList.remove('text-gray-400');
            activeButton.classList.add('text-violet-500');
        }

        // Función para ocultar todas las vistas
        function hideAllViews() {
            const allViews = [homeView, outfitsView, itemsView, singleOutfitView, singleItemView, searchView];
            allViews.forEach(view => {
                view.classList.add('hidden');
                view.classList.remove('flex');
            });
        }

        // Función para mostrar la vista de la página principal (Home)
        function showHomeView(message = null) {
            hideAllViews();
            homeView.classList.remove('hidden');
            homeView.classList.add('flex');
            updateNavButtonColors(homeButton);
            if (message) {
                homeView.innerHTML = `
                    <div class="flex flex-col items-center justify-center p-4 text-center">
                        <div class="flex items-center justify-center h-16 w-16 rounded-full bg-green-100 text-green-500 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <p class="text-xl font-semibold text-gray-800">${message}</p>
                    </div>
                `;
                setTimeout(() => {
                    homeView.innerHTML = `
                        <h1 class="text-4xl font-bold text-gray-800 mb-4">Bienvenido a tu closet</h1>
                        <p class="text-center text-gray-600">
                            Organiza tus items y outfits, y encuentra la inspiración para tu próximo look.
                        </p>
                    `;
                }, 3000);
            }
        }

        // Función para mostrar la vista de los outfits
        function showOutfitsView() {
            hideAllViews();
            outfitsView.classList.remove('hidden');
            outfitsView.classList.add('flex');
            updateNavButtonColors(outfitsButton);
            renderOutfits(outfits, outfitsGrid);
        }

        // Función para mostrar la vista de los items
        function showItemsView() {
            hideAllViews();
            itemsView.classList.remove('hidden');
            itemsView.classList.add('flex');
            updateNavButtonColors(itemsButton);
            renderCategories();
            renderTagsForCategory(); // Renderiza las etiquetas al cargar la vista, inicialmente vacías
            filterItems(); // Muestra todos los ítems al inicio
        }

        // Función para mostrar la vista de búsqueda
        function showSearchView() {
            hideAllViews();
            searchView.classList.remove('hidden');
            searchView.classList.add('flex');
            updateNavButtonColors(searchButton);
            // Limpia los resultados de búsqueda al cambiar a la vista de búsqueda
            searchResultsContainer.innerHTML = '';
            // Limpia el input de búsqueda
            searchInput.value = '';
            renderSuggestedTags();
        }

        // Función para mostrar la vista de un solo outfit
        function showSingleOutfitView(outfit) {
            hideAllViews();
            singleOutfitView.classList.remove('hidden');
            singleOutfitView.classList.add('flex');
            
            // Asigna el outfit a los botones de acción para facilitar la eliminación
            deleteOutfitButton.dataset.outfitId = outfit.id;
            editOutfitButton.dataset.outfitId = outfit.id;
            
            // Oculta el menú de opciones al cargar
            outfitOptionsMenu.classList.add('hidden');
            
            // Renderizar la imagen del outfit
            const outfitImage = singleOutfitView.querySelector('.single-outfit-placeholder');
            outfitImage.innerHTML = `<img src="${outfit.image}" alt="Outfit" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x500/E5E7EB/4B5563?text=Imagen+no+disponible';">`;

            // Renderizar los ítems del outfit
            outfitItemsGrid.innerHTML = '';
            outfit.items.forEach(itemId => {
                const item = items.find(i => i.id === itemId);
                if (item) {
                    const itemElement = document.createElement('div');
                    itemElement.classList.add('bg-gray-200', 'overflow-hidden', 'item-thumbnail', 'cursor-pointer', 'hover:opacity-75', 'transition-opacity');
                    itemElement.innerHTML = `<img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x400/E5E7EB/4B5563?text=Imagen+no+disponible';">`;
                    itemElement.addEventListener('click', () => showSingleItemView(item));
                    outfitItemsGrid.appendChild(itemElement);
                }
            });
        }

        // Función para mostrar la vista de un solo ítem
        function showSingleItemView(item) {
            hideAllViews();
            singleItemView.classList.remove('hidden');
            singleItemView.classList.add('flex');
            
            // Asigna el ítem a los botones de acción para facilitar la eliminación y edición
            deleteItemButton.dataset.itemId = item.id;
            editItemButton.dataset.itemId = item.id;

            // Oculta el menú de opciones al cargar
            itemOptionsMenu.classList.add('hidden');

            // Renderizar la imagen del ítem
            itemImage.innerHTML = `<img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x400/E5E7EB/4B5563?text=Imagen+no+disponible';">`;
            
            // Renderizar los detalles del ítem
            itemName.textContent = item.name;
            itemCategory.textContent = `Categoría: ${item.category}`;

            // Renderizar las etiquetas del ítem
            itemTags.innerHTML = '';
            item.tags.forEach(tag => {
                const tagButton = document.createElement('button');
                tagButton.classList.add('search-term-button', 'px-4', 'py-2', 'rounded-full', 'bg-gray-200', 'text-gray-600', 'text-xs', 'font-normal');
                tagButton.textContent = tag;
                tagButton.addEventListener('click', () => performSearch(tag));
                itemTags.appendChild(tagButton);
            });

            // Renderizar los outfits que contienen este ítem
            itemOutfitsGrid.innerHTML = '';
            const relatedOutfits = outfits.filter(outfit => outfit.items.includes(item.id));
            renderOutfits(relatedOutfits, itemOutfitsGrid);
        }

        // Función para renderizar los outfits en una cuadrícula dada
        function renderOutfits(outfitList, gridContainer) {
            gridContainer.innerHTML = '';
            outfitList.forEach(outfit => {
                const outfitElement = document.createElement('div');
                outfitElement.classList.add('bg-gray-200', 'overflow-hidden', 'outfit-thumbnail', 'cursor-pointer', 'hover:opacity-75', 'transition-opacity');
                outfitElement.innerHTML = `<img src="${outfit.image}" alt="Outfit" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x500/E5E7EB/4B5563?text=Imagen+no+disponible';">`;
                outfitElement.addEventListener('click', () => showSingleOutfitView(outfit));
                gridContainer.appendChild(outfitElement);
            });
        }
        
        // Función para renderizar los items en una cuadrícula dada
        function renderItems(itemList, gridContainer) {
            gridContainer.innerHTML = '';
            itemList.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.classList.add('bg-gray-200', 'overflow-hidden', 'item-thumbnail', 'cursor-pointer', 'hover:opacity-75', 'transition-opacity');
                itemElement.innerHTML = `<img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x400/E5E7EB/4B5563?text=Imagen+no+disponible';">`;
                itemElement.addEventListener('click', () => showSingleItemView(item));
                gridContainer.appendChild(itemElement);
            });
        }

        // Función para renderizar las categorías
        function renderCategories() {
            categoriesContainer.innerHTML = '';
            const categories = getCategories();
            
            // Define el estilo para los botones
            const buttonClass = 'px-4 py-2 text-sm whitespace-nowrap rounded-full transition-colors font-semibold';
            const inactiveClass = 'bg-gray-200 text-gray-800 hover:bg-violet-100 hover:text-violet-800';
            const activeClass = 'bg-violet-500 text-white';

            categories.forEach(category => {
                const categoryButton = document.createElement('button');
                
                let currentClass = buttonClass;
                if (category === activeCategory) {
                    currentClass += ' ' + activeClass;
                } else {
                    currentClass += ' ' + inactiveClass;
                }
                categoryButton.className = currentClass;
                
                categoryButton.textContent = category;
                
                categoryButton.addEventListener('click', () => {
                    if (category === activeCategory) {
                        activeCategory = null;
                        activeTag = null;
                    } else {
                        activeCategory = category;
                        activeTag = null;
                    }
                    renderCategories();
                    renderTagsForCategory();
                    filterItems();
                });
                categoriesContainer.appendChild(categoryButton);
            });
        }

        // Función para renderizar las etiquetas para la categoría activa
        function renderTagsForCategory() {
            tagsContainer.innerHTML = '';
            if (activeCategory) {
                const itemsInCategory = items.filter(item => item.category === activeCategory);
                const allTags = itemsInCategory.flatMap(item => item.tags);
                const uniqueTags = [...new Set(allTags)].sort();
                
                uniqueTags.forEach(tag => {
                    const tagButton = document.createElement('button');
                    tagButton.classList.add('px-4', 'py-2', 'rounded-full', 'text-xs', 'whitespace-nowrap', 'transition-colors', 'flex', 'items-center', 'gap-1');
                    
                    const buttonText = document.createElement('span');
                    buttonText.textContent = tag;
                    tagButton.appendChild(buttonText);

                    // Aplica estilos de botón activo si es la etiqueta actual
                    if (tag === activeTag) {
                        tagButton.classList.add('bg-violet-500', 'text-white');
                        const closeIcon = document.createElement('span');
                        closeIcon.classList.add('text-xs', 'cursor-pointer', 'font-bold');
                        closeIcon.textContent = 'x';
                        tagButton.appendChild(closeIcon);
                    } else {
                        tagButton.classList.add('bg-gray-200', 'text-gray-800', 'hover:bg-violet-100', 'hover:text-violet-800');
                    }

                    tagButton.addEventListener('click', () => {
                        if (tag === activeTag) {
                            activeTag = null;
                        } else {
                            activeTag = tag;
                        }
                        renderTagsForCategory(); // Vuelve a renderizar los botones de etiquetas
                        filterItems(); // Filtra los ítems nuevamente
                    });
                    tagsContainer.appendChild(tagButton);
                });
            }
        }
        
        // Función para filtrar los ítems por categoría y etiqueta
        function filterItems() {
            let filteredItems = items;
            
            if (activeCategory) {
                filteredItems = filteredItems.filter(item => item.category === activeCategory);
            }

            if (activeTag) {
                filteredItems = filteredItems.filter(item => item.tags.includes(activeTag));
            }

            renderItems(filteredItems, itemsGrid);
        }

        // Función para renderizar las etiquetas sugeridas
        function renderSuggestedTags() {
            suggestedTagsContainer.innerHTML = '';
            const allTags = getAllTags();
            
            // Mostrar solo las primeras 6 etiquetas como sugeridas
            allTags.slice(0, 6).forEach(tag => {
                const tagButton = document.createElement('button');
                tagButton.classList.add('search-term-button', 'px-4', 'py-2', 'rounded-full', 'bg-gray-200', 'text-gray-800', 'text-sm', 'whitespace-nowrap');
                tagButton.textContent = tag;
                tagButton.addEventListener('click', () => performSearch(tag));
                suggestedTagsContainer.appendChild(tagButton);
            });
        }

        // Función de búsqueda simulada
        function performSearch(searchTerm) {
            searchInput.value = searchTerm;
            searchResultsContainer.innerHTML = '';
            
            const lowerSearchTerm = searchTerm.toLowerCase();

            // Buscar items que coincidan con el término de búsqueda
            const matchingItems = items.filter(item => 
                item.name.toLowerCase().includes(lowerSearchTerm) || 
                item.category.toLowerCase().includes(lowerSearchTerm) ||
                item.tags.some(tag => tag.toLowerCase().includes(lowerSearchTerm))
            );

            // Buscar outfits que coincidan con el término de búsqueda
            const matchingOutfits = outfits.filter(outfit => 
                outfit.tags.some(tag => tag.toLowerCase().includes(lowerSearchTerm))
            );

            // Renderizar los resultados en una sola cuadrícula
            const allResults = [...matchingItems, ...matchingOutfits];
            
            allResults.forEach(result => {
                const isItem = result.hasOwnProperty('category');
                const placeholder = document.createElement('div');
                placeholder.classList.add('bg-gray-200', 'overflow-hidden', 'flex', 'items-center', 'justify-center', 'text-gray-400', 'font-bold', 'cursor-pointer', 'hover:opacity-75', 'transition-opacity');
                
                if (isItem) {
                    placeholder.classList.add('item-thumbnail');
                    placeholder.innerHTML = `<img src="${result.image}" alt="${result.name}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x400/E5E7EB/4B5563?text=Imagen+no+disponible';">`;
                    placeholder.addEventListener('click', () => showSingleItemView(result));
                } else {
                    placeholder.classList.add('outfit-thumbnail');
                    placeholder.innerHTML = `<img src="${result.image}" alt="Outfit" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/400x500/E5E7EB/4B5563?text=Imagen+no+disponible';">`;
                    placeholder.addEventListener('click', () => showSingleOutfitView(result));
                }
                
                searchResultsContainer.appendChild(placeholder);
            });
        }
        
        // Función para eliminar un ítem
        function deleteItem(itemId) {
            items = items.filter(item => item.id !== itemId);
            showHomeView('¡Ítem eliminado!');
        }

        // Función para eliminar un outfit
        function deleteOutfit(outfitId) {
            outfits = outfits.filter(outfit => outfit.id !== outfitId);
            showHomeView('¡Outfit eliminado!');
        }
        
        // Función para mostrar el modal de edición de ítem
        function showEditItemModal(itemId) {
            currentItem = items.find(item => item.id === itemId);
            if (!currentItem) return;
            
            // Cargar el nombre y la imagen actuales en el modal
            editItemNameInput.value = currentItem.name;
            editItemImagePreview.src = currentItem.image;
            
            // Actualiza la lista de categorías en el select
            editCategorySelect.innerHTML = '';
            const categories = getCategories();
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                if (category === currentItem.category) {
                    option.selected = true;
                }
                editCategorySelect.appendChild(option);
            });
            
            // Renderiza las etiquetas del ítem en el modal
            renderEditingTags();
            // Renderiza las etiquetas sugeridas en el modal
            renderSuggestedEditingTags();

            editItemModal.classList.remove('hidden');
            editItemModal.classList.add('flex');
        }

        // Función para mostrar el modal de edición de outfit
        function showEditOutfitModal(outfitId) {
            currentOutfit = outfits.find(outfit => outfit.id === outfitId);
            if (!currentOutfit) return;

            // Cargar el nombre y la imagen actuales
            editOutfitNameInput.value = currentOutfit.name;
            editOutfitImagePreview.src = currentOutfit.image;

            // Renderiza las etiquetas del outfit en el modal
            renderEditingOutfitTags();
            // Renderiza las etiquetas sugeridas para el outfit
            renderSuggestedEditingOutfitTags();

            // Renderiza la lista de ítems para seleccionar
            renderSelectableItemsForOutfit(editingOutfitItemsContainer, currentOutfit.items);

            editOutfitModal.classList.remove('hidden');
            editOutfitModal.classList.add('flex');
        }
        
        // Función para mostrar el modal de carga y resetear los formularios
        function showUploadModal() {
            // Resetear formularios
            newItemNameInput.value = '';
            newOutfitNameInput.value = '';
            newItemTags = [];
            newOutfit.items = [];
            newOutfit.tags = [];
            newItemImagePreview.src = 'https://placehold.co/400x400/E5E7EB/4B5563?text=Sin+imagen';
            newOutfitImagePreview.src = 'https://placehold.co/400x500/E5E7EB/4B5563?text=Sin+imagen';

            // Ocultar los contenidos de ambos formularios
            uploadItemContent.classList.add('hidden');
            uploadOutfitContent.classList.add('hidden');

            // Renderizar categorías para la nueva subida de ítem
            renderNewItemCategories();
            // Renderizar etiquetas para la nueva subida de ítem
            renderNewItemTags();
            renderNewItemSuggestedTags();
            
            // Renderizar los ítems para la nueva subida de outfit
            renderNewOutfitTags();
            renderNewOutfitSuggestedTags();

            // Mostrar la pestaña por defecto (Ítem)
            selectTab('item');

            uploadModal.classList.remove('hidden');
            uploadModal.classList.add('flex');
        }
        
        // Función para seleccionar la pestaña
        function selectTab(tab) {
            if (tab === 'item') {
                uploadItemTab.classList.add('border-violet-500', 'text-violet-500');
                uploadItemTab.classList.remove('border-transparent', 'text-gray-400');
                uploadOutfitTab.classList.remove('border-violet-500', 'text-violet-500');
                uploadOutfitTab.classList.add('border-transparent', 'text-gray-400');
                uploadItemContent.classList.remove('hidden');
                uploadOutfitContent.classList.add('hidden');
            } else {
                uploadOutfitTab.classList.add('border-violet-500', 'text-violet-500');
                uploadOutfitTab.classList.remove('border-transparent', 'text-gray-400');
                uploadItemTab.classList.remove('border-violet-500', 'text-violet-500');
                uploadItemTab.classList.add('border-transparent', 'text-gray-400');
                uploadItemContent.classList.add('hidden');
                uploadOutfitContent.classList.remove('hidden');

                // Renderizar los ítems seleccionables al cambiar a la pestaña de outfit
                renderSelectableItemsForOutfit(newOutfitItemsContainer, newOutfit.items);
            }
        }

        // Renderiza la lista de ítems para seleccionar en el modal de outfit
        function renderSelectableItemsForOutfit(container, selectedItems) {
            container.innerHTML = '';
            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.classList.add('relative', 'bg-gray-200', 'overflow-hidden', 'item-thumbnail', 'cursor-pointer');
                
                // Crea la imagen
                const img = document.createElement('img');
                img.src = item.image;
                img.alt = item.name;
                img.classList.add('w-full', 'h-full', 'object-cover', 'transition-opacity');
                img.onerror = () => { img.src = 'https://placehold.co/400x400/E5E7EB/4B5563?text=Imagen+no+disponible'; };
                itemElement.appendChild(img);
                
                // Overlay para la selección
                const overlay = document.createElement('div');
                overlay.classList.add('absolute', 'inset-0', 'bg-black', 'bg-opacity-50', 'flex', 'items-center', 'justify-center', 'transition-opacity');
                
                const isSelected = selectedItems.includes(item.id);
                if (isSelected) {
                    overlay.classList.add('opacity-100');
                    overlay.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`;
                } else {
                    overlay.classList.add('opacity-0');
                }
                itemElement.appendChild(overlay);

                itemElement.addEventListener('click', () => {
                    const index = selectedItems.indexOf(item.id);
                    if (index > -1) {
                        selectedItems.splice(index, 1);
                    } else {
                        selectedItems.push(item.id);
                    }
                    renderSelectableItemsForOutfit(container, selectedItems);
                });

                container.appendChild(itemElement);
            });
        }
        
        // Renderiza las etiquetas del ítem en el modal de edición
        function renderEditingTags() {
            editingTagsContainer.innerHTML = '';
            currentItem.tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.classList.add('flex', 'items-center', 'gap-1', 'px-2', 'py-1', 'rounded-full', 'bg-violet-500', 'text-white', 'text-xs');
                tagElement.textContent = tag;
                
                const removeButton = document.createElement('button');
                removeButton.classList.add('text-white', 'hover:text-gray-200', 'font-bold', 'text-xs');
                removeButton.textContent = 'x';
                removeButton.addEventListener('click', () => {
                    currentItem.tags = currentItem.tags.filter(t => t !== tag);
                    renderEditingTags();
                    renderSuggestedEditingTags();
                });
                
                tagElement.appendChild(removeButton);
                editingTagsContainer.appendChild(tagElement);
            });
        }
        
        // Renderiza las etiquetas sugeridas para el modal de edición
        function renderSuggestedEditingTags() {
            suggestedEditingTags.innerHTML = '';
            const allTags = getAllTags();
            const tagsToAdd = allTags.filter(tag => !currentItem.tags.includes(tag));
            
            tagsToAdd.forEach(tag => {
                const tagButton = document.createElement('button');
                tagButton.classList.add('px-2', 'py-1', 'rounded-full', 'bg-gray-200', 'text-gray-800', 'text-xs', 'whitespace-nowrap', 'hover:bg-violet-100', 'transition-colors');
                tagButton.textContent = tag;
                tagButton.addEventListener('click', () => {
                    currentItem.tags.push(tag);
                    renderEditingTags();
                    renderSuggestedEditingTags();
                });
                suggestedEditingTags.appendChild(tagButton);
            });
        }

        // Renderiza las etiquetas del outfit en el modal de edición
        function renderEditingOutfitTags() {
            editingOutfitTagsContainer.innerHTML = '';
            currentOutfit.tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.classList.add('flex', 'items-center', 'gap-1', 'px-2', 'py-1', 'rounded-full', 'bg-violet-500', 'text-white', 'text-xs');
                tagElement.textContent = tag;
                
                const removeButton = document.createElement('button');
                removeButton.classList.add('text-white', 'hover:text-gray-200', 'font-bold', 'text-xs');
                removeButton.textContent = 'x';
                removeButton.addEventListener('click', () => {
                    currentOutfit.tags = currentOutfit.tags.filter(t => t !== tag);
                    renderEditingOutfitTags();
                    renderSuggestedEditingOutfitTags();
                });
                
                tagElement.appendChild(removeButton);
                editingOutfitTagsContainer.appendChild(tagElement);
            });
        }

        // Renderiza las etiquetas sugeridas para el modal de edición de outfit
        function renderSuggestedEditingOutfitTags() {
            suggestedEditingOutfitTags.innerHTML = '';
            const allTags = getAllTags();
            const tagsToAdd = allTags.filter(tag => !currentOutfit.tags.includes(tag));
            
            tagsToAdd.forEach(tag => {
                const tagButton = document.createElement('button');
                tagButton.classList.add('px-2', 'py-1', 'rounded-full', 'bg-gray-200', 'text-gray-800', 'text-xs', 'whitespace-nowrap', 'hover:bg-violet-100', 'transition-colors');
                tagButton.textContent = tag;
                tagButton.addEventListener('click', () => {
                    currentOutfit.tags.push(tag);
                    renderEditingOutfitTags();
                    renderSuggestedEditingOutfitTags();
                });
                suggestedEditingOutfitTags.appendChild(tagButton);
            });
        }
        
        // Renderiza todas las etiquetas en el modal global de eliminación
        function renderAllTagsForModal() {
            allTagsContainer.innerHTML = '';
            const allTags = getAllTags();

            allTags.forEach(tag => {
                const tagButton = document.createElement('button');
                tagButton.classList.add('flex', 'items-center', 'gap-1', 'px-3', 'py-1.5', 'rounded-full', 'bg-gray-200', 'text-gray-800', 'text-sm', 'whitespace-nowrap', 'hover:bg-red-100', 'hover:text-red-500', 'transition-colors');
                
                const tagText = document.createElement('span');
                tagText.textContent = tag;
                tagButton.appendChild(tagText);
                
                const deleteIcon = document.createElement('svg');
                deleteIcon.classList.add('h-4', 'w-4');
                deleteIcon.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
                deleteIcon.setAttribute('viewBox', '0 0 20 20');
                deleteIcon.setAttribute('fill', 'currentColor');
                deleteIcon.innerHTML = `<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />`;
                tagButton.appendChild(deleteIcon);
                
                tagButton.addEventListener('click', () => {
                    deleteTag(tag);
                });
                
                allTagsContainer.appendChild(tagButton);
            });
        }

        // Lógica de Renderizado para el nuevo formulario de subida
        function renderNewItemCategories() {
            newCategorySelect.innerHTML = '';
            const categories = getCategories();
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                newCategorySelect.appendChild(option);
            });
        }

        function renderNewItemTags() {
            newItemTagsContainer.innerHTML = '';
            newItemTags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.classList.add('flex', 'items-center', 'gap-1', 'px-2', 'py-1', 'rounded-full', 'bg-violet-500', 'text-white', 'text-xs');
                tagElement.textContent = tag;
                
                const removeButton = document.createElement('button');
                removeButton.classList.add('text-white', 'hover:text-gray-200', 'font-bold', 'text-xs');
                removeButton.textContent = 'x';
                removeButton.addEventListener('click', () => {
                    newItemTags = newItemTags.filter(t => t !== tag);
                    renderNewItemTags();
                    renderNewItemSuggestedTags();
                });
                
                tagElement.appendChild(removeButton);
                newItemTagsContainer.appendChild(tagElement);
            });
        }

        function renderNewItemSuggestedTags() {
            newItemSuggestedTags.innerHTML = '';
            const allTags = getAllTags();
            const tagsToAdd = allTags.filter(tag => !newItemTags.includes(tag));
            
            tagsToAdd.forEach(tag => {
                const tagButton = document.createElement('button');
                tagButton.classList.add('px-2', 'py-1', 'rounded-full', 'bg-gray-200', 'text-gray-800', 'text-xs', 'whitespace-nowrap', 'hover:bg-violet-100', 'transition-colors');
                tagButton.textContent = tag;
                tagButton.addEventListener('click', () => {
                    newItemTags.push(tag);
                    renderNewItemTags();
                    renderNewItemSuggestedTags();
                });
                newItemSuggestedTags.appendChild(tagButton);
            });
        }
        
        function renderNewOutfitTags() {
            newOutfitTagsContainer.innerHTML = '';
            newOutfit.tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.classList.add('flex', 'items-center', 'gap-1', 'px-2', 'py-1', 'rounded-full', 'bg-violet-500', 'text-white', 'text-xs');
                tagElement.textContent = tag;
                
                const removeButton = document.createElement('button');
                removeButton.classList.add('text-white', 'hover:text-gray-200', 'font-bold', 'text-xs');
                removeButton.textContent = 'x';
                removeButton.addEventListener('click', () => {
                    newOutfit.tags = newOutfit.tags.filter(t => t !== tag);
                    renderNewOutfitTags();
                    renderNewOutfitSuggestedTags();
                });
                
                tagElement.appendChild(removeButton);
                newOutfitTagsContainer.appendChild(tagElement);
            });
        }

        function renderNewOutfitSuggestedTags() {
            newOutfitSuggestedTags.innerHTML = '';
            const allTags = getAllTags();
            const tagsToAdd = allTags.filter(tag => !newOutfit.tags.includes(tag));
            
            tagsToAdd.forEach(tag => {
                const tagButton = document.createElement('button');
                tagButton.classList.add('px-2', 'py-1', 'rounded-full', 'bg-gray-200', 'text-gray-800', 'text-xs', 'whitespace-nowrap', 'hover:bg-violet-100', 'transition-colors');
                tagButton.textContent = tag;
                tagButton.addEventListener('click', () => {
                    newOutfit.tags.push(tag);
                    renderNewOutfitTags();
                    renderNewOutfitSuggestedTags();
                });
                newOutfitSuggestedTags.appendChild(tagButton);
            });
        }


        // Función para guardar los cambios del ítem
        function saveItemChanges() {
            if (currentItem) {
                const newName = editItemNameInput.value.trim();
                const newCategory = editCategorySelect.value;
                const newImageFile = editItemImageInput.files[0];
                
                const itemIndex = items.findIndex(item => item.id === currentItem.id);
                if (itemIndex > -1) {
                    // Actualizar el nombre, la categoría y las etiquetas
                    items[itemIndex].name = newName;
                    items[itemIndex].category = newCategory;
                    items[itemIndex].tags = [...currentItem.tags];

                    // Actualizar la imagen si se seleccionó una nueva
                    if (newImageFile) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            items[itemIndex].image = event.target.result;
                            hideEditItemModal();
                            showSingleItemView(items[itemIndex]);
                            showSaveMessage();
                        };
                        reader.readAsDataURL(newImageFile);
                    } else {
                        // Si no hay nueva imagen, simplemente guarda los otros cambios
                        hideEditItemModal();
                        showSingleItemView(items[itemIndex]);
                        showSaveMessage();
                    }
                }
            }
        }

        // Función para guardar los cambios del outfit
        function saveOutfitChanges() {
            if (currentOutfit) {
                const newName = editOutfitNameInput.value.trim();
                const newImageFile = editOutfitImageInput.files[0];
                const outfitIndex = outfits.findIndex(outfit => outfit.id === currentOutfit.id);
                
                if (outfitIndex > -1) {
                    outfits[outfitIndex].name = newName;
                    outfits[outfitIndex].items = [...currentOutfit.items];
                    outfits[outfitIndex].tags = [...currentOutfit.tags];

                    if (newImageFile) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            outfits[outfitIndex].image = event.target.result;
                            hideEditOutfitModal();
                            showSingleOutfitView(outfits[outfitIndex]);
                            showSaveMessage();
                        };
                        reader.readAsDataURL(newImageFile);
                    } else {
                        hideEditOutfitModal();
                        showSingleOutfitView(outfits[outfitIndex]);
                        showSaveMessage();
                    }
                }
            }
        }

        // Función para guardar un nuevo ítem
        function saveNewItem() {
            const name = newItemNameInput.value.trim();
            const category = newCategorySelect.value;
            const imageFile = newItemImageInput.files[0];

            if (!name || !category || !imageFile) {
                return; // No guardar si faltan datos
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const newItem = {
                    id: generateId(),
                    name,
                    category,
                    image: e.target.result,
                    tags: [...newItemTags]
                };
                items.push(newItem);
                hideUploadModal();
                showHomeView('¡Nuevo ítem guardado!');
            };
            reader.readAsDataURL(imageFile);
        }

        // Función para guardar un nuevo outfit
        function saveNewOutfit() {
            const name = newOutfitNameInput.value.trim();
            const imageFile = newOutfitImageInput.files[0];
            const selectedItems = newOutfit.items;

            if (!name || selectedItems.length === 0) {
                return; // No guardar si faltan datos
            }

            // Si no se carga una imagen, se crea una imagen del outfit combinando las de los items.
            if (!imageFile) {
                // Lógica de combinación de imágenes de items. Por ahora, se usa una imagen de placeholder.
                const newOutfitData = {
                    id: generateId(),
                    name,
                    image: `https://placehold.co/400x500/E5E7EB/4B5563?text=${encodeURIComponent(name.replace(' ', '+'))}`,
                    items: [...selectedItems],
                    tags: [...newOutfit.tags]
                };
                outfits.push(newOutfitData);
                hideUploadModal();
                showHomeView('¡Nuevo outfit guardado!');
            } else {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const newOutfitData = {
                        id: generateId(),
                        name,
                        image: e.target.result,
                        items: [...selectedItems],
                        tags: [...newOutfit.tags]
                    };
                    outfits.push(newOutfitData);
                    hideUploadModal();
                    showHomeView('¡Nuevo outfit guardado!');
                };
                reader.readAsDataURL(imageFile);
            }
        }

        // Función para ocultar el modal de edición de ítem
        function hideEditItemModal() {
            editItemModal.classList.remove('flex');
            editItemModal.classList.add('hidden');
            currentItem = null;
        }

        // Función para ocultar el modal de edición de outfit
        function hideEditOutfitModal() {
            editOutfitModal.classList.remove('flex');
            editOutfitModal.classList.add('hidden');
            currentOutfit = null;
        }

        // Función para ocultar el modal de subida
        function hideUploadModal() {
            uploadModal.classList.remove('flex');
            uploadModal.classList.add('hidden');
        }


        // Manejador de eventos para los botones de navegación
        homeButton.addEventListener('click', showHomeView);
        outfitsButton.addEventListener('click', showOutfitsView);
        itemsButton.addEventListener('click', showItemsView);
        searchButton.addEventListener('click', showSearchView);

        // Manejador de eventos para los botones de retroceso
        backToOutfitsButton.addEventListener('click', showOutfitsView);
        backToItemsButton.addEventListener('click', showItemsView);

        // Manejadores para los nuevos botones de opciones
        itemOptionsButton.addEventListener('click', (event) => {
            event.stopPropagation();
            itemOptionsMenu.classList.toggle('hidden');
        });
        outfitOptionsButton.addEventListener('click', (event) => {
            event.stopPropagation();
            outfitOptionsMenu.classList.toggle('hidden');
        });
        document.addEventListener('click', () => {
            itemOptionsMenu.classList.add('hidden');
            outfitOptionsMenu.classList.add('hidden');
        });
        
        // Manejador de eventos para el botón de editar y eliminar
        editItemButton.addEventListener('click', () => {
            const itemId = editItemButton.dataset.itemId;
            showEditItemModal(itemId);
        });
        editOutfitButton.addEventListener('click', () => {
            const outfitId = editOutfitButton.dataset.outfitId;
            showEditOutfitModal(outfitId);
        });

        deleteItemButton.addEventListener('click', () => {
            const itemId = deleteItemButton.dataset.itemId;
            deleteItem(itemId);
        });
        deleteOutfitButton.addEventListener('click', () => {
            const outfitId = deleteOutfitButton.dataset.outfitId;
            deleteOutfit(outfitId);
        });
        
        // Manejador de eventos para el botón de subir
        uploadButton.addEventListener('click', showUploadModal);
        
        // Manejadores de eventos para las pestañas
        uploadItemTab.addEventListener('click', () => selectTab('item'));
        uploadOutfitTab.addEventListener('click', () => selectTab('outfit'));
        
        // Manejadores para los botones de los formularios de subida
        saveNewItemButton.addEventListener('click', saveNewItem);
        cancelNewItemButton.addEventListener('click', hideUploadModal);
        saveNewOutfitButton.addEventListener('click', saveNewOutfit);
        cancelNewOutfitButton.addEventListener('click', hideUploadModal);
        
        // Manejador de eventos para el input de etiquetas en el modal
        tagInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                const newTag = tagInput.value.trim();
                if (newTag && !currentItem.tags.includes(newTag)) {
                    currentItem.tags.push(newTag);
                    tagInput.value = '';
                    renderEditingTags();
                    renderSuggestedEditingTags();
                }
            }
        });

        newItemTagInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                const newTag = newItemTagInput.value.trim();
                if (newTag && !newItemTags.includes(newTag)) {
                    newItemTags.push(newTag);
                    newItemTagInput.value = '';
                    renderNewItemTags();
                    renderNewItemSuggestedTags();
                }
            }
        });

        editOutfitTagInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                const newTag = editOutfitTagInput.value.trim();
                if (newTag && !currentOutfit.tags.includes(newTag)) {
                    currentOutfit.tags.push(newTag);
                    editOutfitTagInput.value = '';
                    renderEditingOutfitTags();
                    renderSuggestedEditingOutfitTags();
                }
            }
        });
        
        newOutfitTagInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                const newTag = newOutfitTagInput.value.trim();
                if (newTag && !newOutfit.tags.includes(newTag)) {
                    newOutfit.tags.push(newTag);
                    newOutfitTagInput.value = '';
                    renderNewOutfitTags();
                    renderNewOutfitSuggestedTags();
                }
            }
        });
        
        // Manejadores de eventos para la edición de imagen
        editImageButton.addEventListener('click', (event) => {
            event.stopPropagation();
            editImageMenu.classList.toggle('hidden');
        });
        
        selectImageOption.addEventListener('click', () => {
            editItemImageInput.click();
            editImageMenu.classList.add('hidden');
        });

        takePhotoOption.addEventListener('click', () => {
            editImageMenu.classList.add('hidden');
            // Simula la acción de abrir la cámara.
            console.log('Abriendo la cámara del dispositivo...');
            // Aquí iría la lógica para acceder a la cámara
        });

        editItemImageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    editItemImagePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
        
        editOutfitImageButton.addEventListener('click', () => {
            editOutfitImageInput.click();
        });
        
        editOutfitImageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    editOutfitImagePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Manejadores para la subida de imagen en los nuevos formularios
        newItemImageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    newItemImagePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        newOutfitImageInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    newOutfitImagePreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
        
        // Manejadores para los botones de cámara
        newItemCameraBtn.addEventListener('click', () => newItemImageInput.click());
        newOutfitCameraBtn.addEventListener('click', () => newOutfitImageInput.click());


        // Oculta el menú de imagen si se hace clic en cualquier otro lugar
        document.addEventListener('click', (event) => {
            if (!editImageButton.contains(event.target) && !editImageMenu.contains(event.target)) {
                editImageMenu.classList.add('hidden');
            }
        });

        // Manejador de eventos para el modal de edición
        saveItemChangesButton.addEventListener('click', saveItemChanges);
        cancelEditButton.addEventListener('click', hideEditItemModal);
        
        saveOutfitChangesButton.addEventListener('click', saveOutfitChanges);
        cancelEditOutfitButton.addEventListener('click', hideEditOutfitModal);
        
        // Manejador del botón para mostrar el modal de eliminación de etiquetas
        editDeleteTagsButton.addEventListener('click', () => {
            globalTagEditModal.classList.remove('hidden');
            globalTagEditModal.classList.add('flex');
            renderAllTagsForModal();
        });
        
        // Manejador del botón para cerrar el modal de eliminación de etiquetas
        closeTagModalButton.addEventListener('click', () => {
            globalTagEditModal.classList.remove('flex');
            globalTagEditModal.classList.add('hidden');
        });

        // Manejador de eventos para el input de búsqueda en tiempo real
        searchInput.addEventListener('input', (event) => {
            const searchTerm = event.target.value.trim();
            if (searchTerm.length > 0) {
                performSearch(searchTerm);
            } else {
                searchResultsContainer.innerHTML = '';
            }
        });

        // Mostrar la vista de inicio al cargar la página por primera vez
        showHomeView();
    </script>

</body>
</html>
